<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SIASAT - Portal Dosen</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Toggle Sidebar (Mobile) -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">â˜° Menu</button>

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="logo-section">
        <div class="logo-badge">
          <img src="img/logo1.png" alt="Foto Rafael" class="logo-photo" />
        </div>
        <div class="logo-text">
          <h1>SIASAT</h1>
          <p>Portal Dosen</p>
        </div>
      </div>

      <div class="profile-card">
        <div class="profile-inner">
          <div class="profile-avatar">ğŸ‘¨â€ğŸ«</div>
          <div class="profile-meta">
            <h2>Dr. BAHLIL</h2>
            <p>NIDN: 1234567890</p>
            <div class="status-chip"><span>â—</span> Dosen Tetap Prodi BD</div>
          </div>
        </div>
      </div>

      <nav class="menu">
        <div class="menu-group">
          <div class="menu-title">Menu Utama</div>

          <div
            class="menu-item active"
            data-page="dashboard"
            onclick="showPage('dashboard', this)"
          >
            <span class="icon">ğŸ </span>
            <span class="label">Dashboard</span>
          </div>

          <div
            class="menu-item"
            data-page="krs"
            onclick="showPage('krs', this)"
          >
            <span class="icon">âœ…</span>
            <span class="label">Validasi KRS</span>
            <span class="menu-badge">4</span>
          </div>

          <div
            class="menu-item"
            data-page="nilai"
            onclick="showPage('nilai', this)"
          >
            <span class="icon">ğŸ“</span>
            <span class="label">Input Nilai</span>
          </div>

          <div
            class="menu-item"
            data-page="jadwal"
            onclick="showPage('jadwal', this)"
          >
            <span class="icon">ğŸ“…</span>
            <span class="label">Jadwal Mengajar</span>
          </div>

          <div
            class="menu-item"
            data-page="pengumuman"
            onclick="showPage('pengumuman', this)"
          >
            <span class="icon">ğŸ“¢</span>
            <span class="label">Pengumuman</span>
          </div>

          <div
            class="menu-item"
            data-page="bimbingan"
            onclick="showPage('bimbingan', this)"
          >
            <span class="icon">ğŸ“</span>
            <span class="label">Bimbingan Akademik</span>
          </div>
        </div>
      </nav>

      <button class="logout-btn" onclick="logout()">
        <span>ğŸšª</span>Keluar dari SIASAT
      </button>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
      <!-- DASHBOARD -->
      <section id="page-dashboard" class="page active">
        <div class="top-bar">
          <div class="page-title-block">
            <h2>Selamat datang, Dosen ğŸ‘‹</h2>
            <p>
              Pantau aktivitas akademik, validasi KRS, dan kelola nilai dalam
              satu portal.
            </p>
          </div>
          <div class="top-bar-right">
            <span class="pill">Tahun Akademik: 2024/2025</span>
            <span class="pill">Semester: Genap</span>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-inner">
              <span class="stat-icon">ğŸ“š</span>
              <div class="stat-label">Mata Kuliah Diampu</div>
              <div class="stat-value">5</div>
              <div class="stat-extra">Termasuk kelas reguler & praktikum</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-inner">
              <span class="stat-icon">ğŸ‘¨â€ğŸ“</span>
              <div class="stat-label">Mahasiswa Dibimbing</div>
              <div class="stat-value">24</div>
              <div class="stat-extra">Bimbingan akademik & tugas akhir</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-inner">
              <span class="stat-icon">âœ…</span>
              <div class="stat-label">KRS Menunggu Validasi</div>
              <div class="stat-value" id="krsPendingCount">4</div>
              <div class="stat-extra">Segera validasi sebelum batas akhir</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-inner">
              <span class="stat-icon">ğŸ“</span>
              <div class="stat-label">Nilai Belum Lengkap</div>
              <div class="stat-value">2</div>
              <div class="stat-extra">Kelas butuh input nilai akhir</div>
            </div>
          </div>
        </div>

        <div class="quick-actions">
          <div class="quick-card" onclick="showPage('krs')">
            <span>âœ…</span>
            <p>Validasi KRS Mahasiswa</p>
          </div>
          <div class="quick-card" onclick="showPage('nilai')">
            <span>ğŸ“</span>
            <p>Input Nilai Ujian</p>
          </div>
          <div class="quick-card" onclick="showPage('jadwal')">
            <span>ğŸ“…</span>
            <p>Lihat Jadwal Mengajar</p>
          </div>
          <div class="quick-card" onclick="showPage('pengumuman')">
            <span>ğŸ“¢</span>
            <p>Kirim Pengumuman Kelas</p>
          </div>
        </div>

        <div class="content-grid">
          <div class="card">
            <div class="card-header">
              <div class="card-title">ğŸ“… Jadwal Mengajar Hari Ini</div>
              <div class="card-link" onclick="showPage('jadwal')">
                Lihat jadwal lengkap â†’
              </div>
            </div>

            <div class="schedule-item">
              <div class="schedule-time">08:00 - 10:00 â€¢ Senin</div>
              <div class="schedule-course">
                Sistem Informasi Manajemen (SIM301)
              </div>
              <div class="schedule-location">ğŸ“ R.301 â€¢ Kelas SI-3A</div>
            </div>
            <div class="schedule-item">
              <div class="schedule-time">13:00 - 15:00 â€¢ Senin</div>
              <div class="schedule-course">Pemrograman Web (WEB302)</div>
              <div class="schedule-location">
                ğŸ’» Lab Komputer 2 â€¢ Kelas SI-3B
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">ğŸ“¢ Pengumuman Terbaru</div>
              <div class="card-link" onclick="showPage('pengumuman')">
                Kelola pengumuman â†’
              </div>
            </div>

            <div class="announcement">
              <span class="announcement-badge badge-danger">PENTING</span>
              <div class="announcement-title">
                Batas Akhir Input Nilai Semester
              </div>
              <div class="announcement-text">
                Input nilai akhir wajib diselesaikan sebelum 10 Maret 2025 pukul
                23.59 WIB.
              </div>
            </div>

            <div class="announcement">
              <span class="announcement-badge badge-info">INFO SISTEM</span>
              <div class="announcement-title">Maintenance Portal Akademik</div>
              <div class="announcement-text">
                Sistem akan tidak dapat diakses pada 1 Maret 2025 pukul
                00.00â€“02.00 WIB.
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- KRS VALIDATION -->
      <section id="page-krs" class="page">
        <div class="top-bar">
          <div class="page-title-block">
            <h2>âœ… Validasi KRS Mahasiswa</h2>
            <p>
              Tinjau dan setujui KRS mahasiswa bimbingan untuk Semester Genap
              2024/2025.
            </p>
          </div>
          <div class="top-bar-right">
            <span class="pill"
              >Total Menunggu: <span id="krsPendingBadge">4</span></span
            >
          </div>
        </div>

        <div class="krs-layout">
          <!-- KIRI: Daftar KRS Masuk -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">Daftar KRS Menunggu Validasi</div>
            </div>

            <div class="krs-controls">
              <input
                type="text"
                class="input-small"
                id="searchMahasiswa"
                placeholder="Cari nama / NIM..."
                oninput="filterKrsList()"
              />
              <select
                id="filterStatusKRS"
                class="input-small"
                onchange="filterKrsList()"
              >
                <option value="">Semua Status</option>
                <option value="pending">Menunggu</option>
                <option value="disetujui">Disetujui</option>
                <option value="ditolak">Ditolak</option>
              </select>
              <button
                class="btn-mini"
                type="button"
                onclick="resetKrsFilterDosen()"
              >
                Reset
              </button>
            </div>

            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>NIM</th>
                    <th>Nama</th>
                    <th>Prodi</th>
                    <th>SKS</th>
                    <th>Status</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="krsListBody">
                  <!-- diisi via JS -->
                </tbody>
              </table>
            </div>

            <div class="krs-info-card">
              <strong>Catatan:</strong>
              <ul>
                <li>
                  KRS yang sudah <strong>disetujui</strong> akan terkunci untuk
                  mahasiswa.
                </li>
                <li>
                  Jika ditolak, berikan catatan agar mahasiswa dapat melakukan
                  revisi.
                </li>
              </ul>
            </div>
          </div>

          <!-- KANAN: Detail KRS Mahasiswa -->
          <div class="card" id="krsDetailCard">
            <div class="card-header">
              <div class="card-title" id="detailTitle">
                Detail KRS Mahasiswa
              </div>
              <button
                class="btn-small"
                type="button"
                onclick="approveSelectedKRS()"
              >
                âœ… Setujui KRS
              </button>
            </div>

            <div class="krs-info-card" id="krsDetailInfo">
              <div>
                Pilih salah satu mahasiswa di tabel kiri untuk melihat detail
                KRS.
              </div>
            </div>

            <div class="table-container krs-table">
              <table>
                <thead>
                  <tr>
                    <th>Kode</th>
                    <th>Mata Kuliah</th>
                    <th>SKS</th>
                    <th>Jadwal</th>
                  </tr>
                </thead>
                <tbody id="krsDetailBody">
                  <!-- diisi via JS -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- INPUT NILAI -->
      <section id="page-nilai" class="page">
        <div class="top-bar">
          <div class="page-title-block">
            <h2>ğŸ“ Input Nilai</h2>
            <p>
              Input nilai UTS, UAS, dan tugas untuk setiap kelas yang diampu.
            </p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Pilih Mata Kuliah</div>
          </div>
          <div class="krs-controls">
            <select
              id="selectMatkul"
              class="input-small"
              onchange="loadNilaiMahasiswa()"
            >
              <option value="SIM301">
                SIM301 - Sistem Informasi Manajemen
              </option>
              <option value="BDL304">BDL304 - Basis Data Lanjut</option>
              <option value="WEB302">WEB302 - Pemrograman Web</option>
            </select>

            <select
              id="selectJenisUjian"
              class="input-small"
              onchange="loadNilaiMahasiswa()"
            >
              <option value="UTS">UTS</option>
              <option value="UAS">UAS</option>
              <option value="Tugas">Tugas</option>
            </select>

            <button
              class="btn-mini"
              type="button"
              onclick="showToast('success','Nilai tersimpan (demo).')"
            >
              ğŸ’¾ Simpan Semua
            </button>
          </div>

          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>NIM</th>
                  <th>Nama Mahasiswa</th>
                  <th>Nilai</th>
                  <th>Grade</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="nilaiTableBody">
                <!-- diisi via JS -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- JADWAL MENGAJAR -->
      <section id="page-jadwal" class="page">
        <div class="top-bar">
          <div class="page-title-block">
            <h2>ğŸ“… Jadwal Mengajar</h2>
            <p>Jadwal mengajar mingguan berdasarkan mata kuliah yang diampu.</p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Jadwal Mingguan</div>
          </div>

          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Hari</th>
                  <th>Waktu</th>
                  <th>Kode</th>
                  <th>Mata Kuliah</th>
                  <th>Kelas</th>
                  <th>Ruangan</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Senin</td>
                  <td>08:00 - 10:00</td>
                  <td>SIM301</td>
                  <td>Sistem Informasi Manajemen</td>
                  <td>SI-3A</td>
                  <td>R.301</td>
                </tr>
                <tr>
                  <td>Senin</td>
                  <td>13:00 - 15:00</td>
                  <td>WEB302</td>
                  <td>Pemrograman Web</td>
                  <td>SI-3B</td>
                  <td>Lab Komputer 2</td>
                </tr>
                <tr>
                  <td>Rabu</td>
                  <td>09:00 - 11:00</td>
                  <td>BDL304</td>
                  <td>Basis Data Lanjut</td>
                  <td>SI-4A</td>
                  <td>R.402</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- PENGUMUMAN -->
      <section id="page-pengumuman" class="page">
        <div class="top-bar">
          <div class="page-title-block">
            <h2>ğŸ“¢ Pengumuman Kelas</h2>
            <p>Kirim pengumuman ke mahasiswa per kelas / mata kuliah.</p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Buat Pengumuman Baru</div>
          </div>

          <div class="form-group">
            <label>Mata Kuliah</label>
            <select
              id="pengumumanMatkul"
              class="input-small"
              style="width: 100%; max-width: 260px"
            >
              <option value="SIM301">
                SIM301 - Sistem Informasi Manajemen
              </option>
              <option value="BDL304">BDL304 - Basis Data Lanjut</option>
              <option value="WEB302">WEB302 - Pemrograman Web</option>
            </select>
          </div>

          <div class="form-group">
            <label>Judul Pengumuman</label>
            <input
              id="pengumumanJudul"
              type="text"
              class="input-small"
              style="width: 100%; max-width: 100%"
              placeholder="Contoh: Perubahan jadwal perkuliahan"
            />
          </div>

          <div class="form-group">
            <label>Isi Pengumuman</label>
            <textarea
              id="pengumumanIsi"
              class="input-small"
              rows="4"
              style="width: 100%; max-width: 100%; resize: vertical"
              placeholder="Tulis isi pengumuman di sini..."
            ></textarea>
          </div>

          <button class="btn-mini" type="button" onclick="kirimPengumuman()">
            ğŸ“¤ Kirim Pengumuman
          </button>
        </div>

        <div class="card" style="margin-top: 1rem">
          <div class="card-header">
            <div class="card-title">Riwayat Pengumuman</div>
          </div>
          <div class="announcement">
            <span class="announcement-badge badge-info">WEB302</span>
            <div class="announcement-title">
              Tugas Project Web - Deadline Diperpanjang
            </div>
            <div class="announcement-text">
              Pengumpulan tugas project web diperpanjang sampai 15 Maret 2025.
            </div>
          </div>
          <div class="announcement">
            <span class="announcement-badge badge-info">SIM301</span>
            <div class="announcement-title">Kuliah Pengganti Hari Jumat</div>
            <div class="announcement-text">
              Kuliah pengganti akan dilaksanakan pada hari Sabtu pukul
              09.00â€“11.00 di R.302.
            </div>
          </div>
        </div>
      </section>

      <!-- BIMBINGAN -->
      <section id="page-bimbingan" class="page">
        <div class="top-bar">
          <div class="page-title-block">
            <h2>ğŸ“ Bimbingan Akademik</h2>
            <p>Daftar mahasiswa bimbingan akademik dan kemajuan studinya.</p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Mahasiswa Bimbingan</div>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>NIM</th>
                  <th>Nama</th>
                  <th>Prodi</th>
                  <th>Angkatan</th>
                  <th>IPK</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>842023012</td>
                  <td>Rafael</td>
                  <td>Sistem Informasi</td>
                  <td>2023</td>
                  <td>3.75</td>
                  <td>
                    <span class="badge-pill badge-success">Baik</span>
                  </td>
                </tr>
                <tr>
                  <td>842023018</td>
                  <td>Anita</td>
                  <td>Sistem Informasi</td>
                  <td>2023</td>
                  <td>3.10</td>
                  <td>
                    <span class="badge-pill badge-muted">Perlu Monitoring</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="placeholder">
            Di sini bisa ditambahkan fitur catatan bimbingan per mahasiswa.
          </div>
        </div>
      </section>
    </main>

    <!-- TOAST -->
    <div id="toast" class="toast">
      <span id="toastIcon" class="toast-icon">â„¹ï¸</span>
      <span id="toastMessage"></span>
    </div>

    <script>
      // ===== NAV / PAGE SWITCH =====
      function showPage(pageId, el) {
        document
          .querySelectorAll(".page")
          .forEach((p) => p.classList.remove("active"));
        const page = document.getElementById("page-" + pageId);
        if (page) page.classList.add("active");

        document
          .querySelectorAll(".menu-item")
          .forEach((mi) => mi.classList.remove("active"));

        if (el) {
          el.classList.add("active");
        } else {
          const menu = document.querySelector(
            '.menu-item[data-page="' + pageId + '"]'
          );
          if (menu) menu.classList.add("active");
        }

        document.getElementById("sidebar").classList.remove("open");
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("open");
      }

      function logout() {
        window.location.href = "login.html";
      }

      // ===== TOAST =====
      let toastTimeout;
      function showToast(type, message) {
        const toast = document.getElementById("toast");
        const icon = document.getElementById("toastIcon");
        const msg = document.getElementById("toastMessage");

        toast.classList.remove("toast-success", "toast-error");
        if (type === "success") {
          toast.classList.add("toast-success");
          icon.textContent = "âœ…";
        } else {
          toast.classList.add("toast-error");
          icon.textContent = "âš ï¸";
        }
        msg.textContent = message;

        toast.classList.add("show");
        clearTimeout(toastTimeout);
        toastTimeout = setTimeout(() => {
          toast.classList.remove("show");
        }, 3000);
      }

      // ===== DATA DUMMY KRS UNTUK DOSEN =====
      const krsMahasiswa = [
        {
          nim: "842023012",
          nama: "Rafael",
          prodi: "Sistem Informasi",
          sks: 22,
          status: "pending",
          matkul: [
            {
              kode: "SIM301",
              nama: "Sistem Informasi Manajemen",
              sks: 3,
              jadwal: "Senin 08:00 - 10:00",
            },
            {
              kode: "BDL304",
              nama: "Basis Data Lanjut",
              sks: 3,
              jadwal: "Rabu 09:00 - 11:00",
            },
          ],
        },
        {
          nim: "842023018",
          nama: "Anita",
          prodi: "Sistem Informasi",
          sks: 20,
          status: "pending",
          matkul: [
            {
              kode: "WEB302",
              nama: "Pemrograman Web",
              sks: 3,
              jadwal: "Senin 13:00 - 15:00",
            },
            {
              kode: "BDL304",
              nama: "Basis Data Lanjut",
              sks: 3,
              jadwal: "Rabu 09:00 - 11:00",
            },
          ],
        },
        {
          nim: "842023010",
          nama: "Budi",
          prodi: "Sistem Informasi",
          sks: 24,
          status: "disetujui",
          matkul: [],
        },
        {
          nim: "842023011",
          nama: "Sari",
          prodi: "Sistem Informasi",
          sks: 18,
          status: "ditolak",
          matkul: [],
        },
      ];

      let selectedKrsNim = null;

      function renderKrsList() {
        const tbody = document.getElementById("krsListBody");
        tbody.innerHTML = "";

        const search = document
          .getElementById("searchMahasiswa")
          .value.toLowerCase();
        const filterStatus = document.getElementById("filterStatusKRS").value;

        let pendingCount = 0;

        krsMahasiswa.forEach((mhs) => {
          if (
            search &&
            !(
              mhs.nim.toLowerCase().includes(search) ||
              mhs.nama.toLowerCase().includes(search)
            )
          )
            return;
          if (filterStatus && mhs.status !== filterStatus) return;

          if (mhs.status === "pending") pendingCount++;

          const tr = document.createElement("tr");
          let statusLabel = "";
          if (mhs.status === "pending") {
            statusLabel =
              '<span class="badge-pill badge-warning">Menunggu</span>';
          } else if (mhs.status === "disetujui") {
            statusLabel =
              '<span class="badge-pill badge-success">Disetujui</span>';
          } else {
            statusLabel = '<span class="badge-pill badge-muted">Ditolak</span>';
          }

          tr.innerHTML = `
            <td>${mhs.nim}</td>
            <td>${mhs.nama}</td>
            <td>${mhs.prodi}</td>
            <td>${mhs.sks}</td>
            <td>${statusLabel}</td>
            <td>
              <button class="btn-mini" type="button" onclick="lihatDetailKRS('${mhs.nim}')">
                Lihat
              </button>
            </td>
          `;
          tbody.appendChild(tr);
        });

        document.getElementById("krsPendingCount").textContent = pendingCount;
        document.getElementById("krsPendingBadge").textContent = pendingCount;
      }

      function filterKrsList() {
        renderKrsList();
      }

      function resetKrsFilterDosen() {
        document.getElementById("searchMahasiswa").value = "";
        document.getElementById("filterStatusKRS").value = "";
        renderKrsList();
      }

      function lihatDetailKRS(nim) {
        selectedKrsNim = nim;
        const mhs = krsMahasiswa.find((m) => m.nim === nim);
        if (!mhs) return;

        const detailTitle = document.getElementById("detailTitle");
        const detailInfo = document.getElementById("krsDetailInfo");
        const tbody = document.getElementById("krsDetailBody");

        detailTitle.textContent =
          "KRS " + mhs.nama + " (" + mhs.nim + ") - " + mhs.sks + " SKS";
        detailInfo.innerHTML =
          "<div>Prodi: <strong>" +
          mhs.prodi +
          "</strong> â€¢ Status: <strong>" +
          mhs.status.toUpperCase() +
          "</strong></div>";

        tbody.innerHTML = "";
        if (!mhs.matkul || mhs.matkul.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="4">Detail mata kuliah belum disimulasikan (demo).</td></tr>';
          return;
        }

        mhs.matkul.forEach((mk) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${mk.kode}</td>
            <td>${mk.nama}</td>
            <td>${mk.sks}</td>
            <td>${mk.jadwal}</td>
          `;
          tbody.appendChild(tr);
        });
      }

      function approveSelectedKRS() {
        if (!selectedKrsNim) {
          showToast("error", "Pilih dulu mahasiswa yang akan divalidasi.");
          return;
        }
        const mhs = krsMahasiswa.find((m) => m.nim === selectedKrsNim);
        if (!mhs) return;

        mhs.status = "disetujui";
        showToast(
          "success",
          "KRS " + mhs.nama + " (" + mhs.nim + ") telah disetujui."
        );
        renderKrsList();
        lihatDetailKRS(mhs.nim);
      }

      // ===== DATA NILAI DUMMY =====
      const nilaiMahasiswaDummy = [
        { nim: "842023012", nama: "Rafael", nilai: 85 },
        { nim: "842023013", nama: "Eka", nilai: 78 },
        { nim: "842023014", nama: "Steffen", nilai: 90 },
        { nim: "842023015", nama: "William", nilai: 88 },
      ];

      function hitungGrade(nilai) {
        if (nilai >= 85) return "A";
        if (nilai >= 80) return "A-";
        if (nilai >= 75) return "B+";
        if (nilai >= 70) return "B";
        if (nilai >= 65) return "C+";
        if (nilai >= 60) return "C";
        if (nilai >= 50) return "D";
        return "E";
      }

      function loadNilaiMahasiswa() {
        const tbody = document.getElementById("nilaiTableBody");
        tbody.innerHTML = "";

        nilaiMahasiswaDummy.forEach((mhs, idx) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${mhs.nim}</td>
            <td>${mhs.nama}</td>
            <td>
              <input type="number" min="0" max="100" value="${
                mhs.nilai
              }" style="width:70px" onchange="updateGrade(this, ${idx})" />
            </td>
            <td id="grade-${idx}">${hitungGrade(mhs.nilai)}</td>
            <td>
              <button class="btn-mini" type="button" onclick="showToast('success','Nilai ${
                mhs.nama
              } disimpan (demo).')">
                Simpan
              </button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }

      function updateGrade(input, idx) {
        let nilai = parseInt(input.value, 10);
        if (isNaN(nilai)) nilai = 0;
        if (nilai < 0) nilai = 0;
        if (nilai > 100) nilai = 100;
        input.value = nilai;
        document.getElementById("grade-" + idx).textContent =
          hitungGrade(nilai);
      }

      // ===== PENGUMUMAN =====
      function kirimPengumuman() {
        const matkul = document.getElementById("pengumumanMatkul").value;
        const judul = document.getElementById("pengumumanJudul").value.trim();
        const isi = document.getElementById("pengumumanIsi").value.trim();

        if (!judul || !isi) {
          showToast("error", "Judul dan isi pengumuman tidak boleh kosong.");
          return;
        }

        showToast(
          "success",
          "Pengumuman untuk " + matkul + " berhasil dikirim (demo)."
        );

        document.getElementById("pengumumanJudul").value = "";
        document.getElementById("pengumumanIsi").value = "";
      }

      // INIT
      document.addEventListener("DOMContentLoaded", () => {
        renderKrsList();
        loadNilaiMahasiswa();
        showPage("dashboard");
      });
    </script>
  </body>
</html>
